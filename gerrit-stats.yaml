- project:
    name: Gerrit-Stats
    jobs:
      - '{name}'

- job-template: 
    name: '{name}'
    description: 'Generate Gerrit Stats Automatically By Jenkins Jobs'
    project-type: pipeline
    triggers:
      - timed: '0 0 * * 0'
    dsl: |
      node {{
        stage('Check out source code') {{
          git branch: 'main', url: 'https://github.com/lminhthuan225/gerrit-stats.git'
        }}
        stage('Download json data from Gerrit') {{
          # withCredentials() {{
            sh "$WORKSPACE/gerrit_downloader.sh -s pkhai@gerrit.dev.legato -i ~/.ssh/pkhai_id_rsa -o json-storage"
          # }}
        }}
        stage('Generate Stats') {{
          sh "$WORKSPACE/gerrit_stats.sh"
        }}
        stage('Build Docker Image') {{
          docker build -t ...
        }}
        stage('Push docker image') {{
          docker image tag ... ...
          docker push
        }}
      }}


